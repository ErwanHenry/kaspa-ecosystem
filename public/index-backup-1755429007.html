<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaspa Ecosystem - Discover Projects Building on Kaspa</title>
    <meta name="description" content="Explore the growing ecosystem of projects building on Kaspa blockchain. Wallets, mining tools, DeFi, NFTs and more.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/kaspa-ecosystem.css">
    
    <style>
        /* Enhanced Features Styles */
        .footer-content { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2rem; }
        .footer-section h4 { color: #49EACB; margin-bottom: 1rem; }
        .newsletter-form { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
        .newsletter-form input { flex: 1; padding: 0.5rem; border: 1px solid #334155; background: #1E293B; color: #CBD5E1; border-radius: 4px; }
        .newsletter-desc { font-size: 0.9rem; opacity: 0.8; }
        .rss-links { display: flex; flex-direction: column; gap: 0.5rem; }
        .rss-link { color: #49EACB; text-decoration: none; padding: 0.25rem 0; }
        .rss-link:hover { color: #22D3EE; }
        .footer-features { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .feature-badge { background: rgba(73, 234, 203, 0.1); color: #49EACB; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem; }
        .btn-icon { background: transparent; border: 1px solid #334155; color: #CBD5E1; padding: 0.5rem; border-radius: 6px; }
        .btn-icon:hover { background: rgba(73, 234, 203, 0.1); color: #49EACB; }
        @media (max-width: 768px) { .footer-content { grid-template-columns: 1fr; } }
    </style>
    
    <style>
        /* Base styles while CSS loads */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #0F172A;
            color: #CBD5E1;
            line-height: 1.6;
        }
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0F172A;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .loading-content {
            text-align: center;
        }
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid #1E293B;
            border-top-color: #49EACB;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-text {
            color: #49EACB;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">⚡ Loading Kaspa Ecosystem...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="/" class="brand-link">
                    <span class="brand-icon">⚡</span>
                    <span class="brand-text">Kaspa Ecosystem</span>
                </a>
            </div>
            
            <div class="nav-menu" id="navMenu">
                <a href="#featured" class="nav-link">Featured</a>
                <a href="#projects" class="nav-link">Projects</a>
                <a href="#categories" class="nav-link">Categories</a>
                <a href="/admin-enhanced.html" class="nav-link">Admin</a>
            </div>
            
            <div class="nav-actions">
                <button class="btn btn-icon" id="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                <button class="btn btn-primary btn-sm" onclick="showSubmitModal()">
                    <i class="fas fa-plus"></i> Submit Project
                </button>
                <button class="btn btn-secondary btn-sm" id="walletBtn" onclick="showWalletModal()">
                    <i class="fas fa-wallet"></i>
                    <span id="wallet-status">Connect</span>
                </button>
                <button class="nav-toggle" id="navToggle" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-background">
            <div class="grid-pattern"></div>
        </div>
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Discover the <span class="text-gradient">Kaspa Ecosystem</span>
                </h1>
                <p class="hero-subtitle">
                    Explore wallets, mining tools, DeFi protocols, and innovative projects building on the fastest proof-of-work blockchain
                </p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="total-projects">0</span>
                        <span class="stat-label">Projects</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="total-categories">0</span>
                        <span class="stat-label">Categories</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="active-users">0</span>
                        <span class="stat-label">Active Users</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Projects Carousel -->
    <section id="featured" class="featured-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-star"></i> Featured Projects
                </h2>
                <p class="section-subtitle">Community-sponsored projects showcasing the best of Kaspa</p>
            </div>
            
            <div class="carousel-wrapper">
                <div class="carousel-container" id="featuredCarousel">
                    <div class="carousel-track" id="carouselTrack">
                        <!-- Featured projects will be loaded here -->
                    </div>
                </div>
                <button class="carousel-control prev" onclick="moveCarousel(-1)" aria-label="Previous">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="carousel-control next" onclick="moveCarousel(1)" aria-label="Next">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <div id="no-featured" class="empty-state" style="display: none;">
                <i class="fas fa-trophy empty-icon"></i>
                <h3>No Featured Projects Yet</h3>
                <p>Be the first to sponsor a project and showcase it here!</p>
            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section id="categories" class="categories-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-th-large"></i> Browse by Category
                </h2>
            </div>
            <div class="categories-grid" id="categoriesGrid">
                <!-- Categories will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Projects Section -->
    <section id="projects" class="projects-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-cube"></i> All Projects
                </h2>
                <div class="section-controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search projects..." onkeyup="searchProjects(this.value)">
                    </div>
                    <select class="sort-select" id="sortSelect" onchange="sortProjects(this.value)">
                        <option value="recent">Most Recent</option>
                        <option value="rating">Highest Rated</option>
                        <option value="name">Alphabetical</option>
                    </select>
                </div>
            </div>
            
            <div class="projects-grid" id="projectsGrid">
                <!-- Projects will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>📧 Stay Updated</h4>
                    <form id="newsletter-form" class="newsletter-form">
                        <input type="email" id="newsletter-email" placeholder="Enter your email" required>
                        <button type="submit" class="btn btn-primary btn-sm">Subscribe</button>
                    </form>
                    <p class="newsletter-desc">Get weekly updates on new Kaspa ecosystem projects</p>
                </div>
                
                <div class="footer-section">
                    <h4>📡 RSS Feeds</h4>
                    <div class="rss-links">
                        <a href="/api/rss-feeds?format=rss" class="rss-link">
                            <i class="fas fa-rss"></i> RSS 2.0
                        </a>
                        <a href="/api/rss-feeds?format=atom" class="rss-link">
                            <i class="fas fa-rss"></i> Atom
                        </a>
                        <a href="/api/rss-feeds?format=json" class="rss-link">
                            <i class="fas fa-code"></i> JSON Feed
                        </a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <p>&copy; 2024 Kaspa Ecosystem. Open source project.</p>
                    <p>Built with ❤️ by the Kaspa community</p>
                    <div class="footer-features">
                        <span class="feature-badge">🔗 Multi-Wallet</span>
                        <span class="feature-badge">🤖 AI Discovery</span>
                        <span class="feature-badge">⭐ 6D Ratings</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Wallet Modal -->
    <div id="wallet-modal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3><i class="fas fa-wallet"></i> Connect Wallet</h3>
                <button class="modal-close" onclick="closeModal('wallet-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="wallet-options">
                    <button class="wallet-option" onclick="connectWallet('kasware')">
                        <span class="wallet-icon">🟢</span>
                        <span>Kasware Wallet</span>
                        <span class="wallet-status">Available</span>
                    </button>
                    <button class="wallet-option disabled">
                        <span class="wallet-icon">🏰</span>
                        <span>Kastle Wallet</span>
                        <span class="wallet-status">Coming Soon</span>
                    </button>
                    <button class="wallet-option disabled">
                        <span class="wallet-icon">💎</span>
                        <span>KSPR Wallet</span>
                        <span class="wallet-status">Coming Soon</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Project Modal -->
    <div id="submit-modal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fas fa-rocket"></i> Submit New Project</h3>
                <button class="modal-close" onclick="closeModal('submit-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="submit-form" onsubmit="submitProject(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Project Name <span class="required">*</span></label>
                            <input type="text" name="title" required maxlength="100" placeholder="My Awesome Project">
                        </div>
                        <div class="form-group">
                            <label>Category <span class="required">*</span></label>
                            <select name="category" required>
                                <option value="">Select a category</option>
                                <option value="wallets">Wallet</option>
                                <option value="mining">Mining</option>
                                <option value="defi">DeFi</option>
                                <option value="nfts">NFT</option>
                                <option value="tools">Tool</option>
                                <option value="infrastructure">Infrastructure</option>
                                <option value="education">Education</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Description <span class="required">*</span></label>
                        <textarea name="description" rows="4" required maxlength="500" placeholder="Describe your project..."></textarea>
                        <small class="form-hint">Max 500 characters</small>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Website URL <span class="required">*</span></label>
                            <input type="url" name="website" required placeholder="https://myproject.com">
                        </div>
                        <div class="form-group">
                            <label>Logo URL</label>
                            <input type="url" name="logo_url" placeholder="https://myproject.com/logo.png">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Social Links</label>
                        <div class="social-grid">
                            <input type="url" name="twitter" placeholder="Twitter/X URL">
                            <input type="url" name="github" placeholder="GitHub URL">
                            <input type="url" name="discord" placeholder="Discord URL">
                            <input type="url" name="telegram" placeholder="Telegram URL">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="terms" required>
                            I confirm this is a legitimate Kaspa ecosystem project
                        </label>
                    </div>
                    
                    <div id="wallet-notice" class="wallet-notice">
                        <i class="fas fa-info-circle"></i>
                        Please connect your wallet to submit a project
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('submit-modal')">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="submit-btn">
                            <i class="fas fa-paper-plane"></i> Submit Project
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div id="project-modal" class="modal">
        <div class="modal-content modal-xl">
            <div id="project-details">
                <!-- Project details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/kaspa-wallet-integration.js"></script>
    <script src="js/multi-wallet-ui.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/social-sharing.js"></script>
    <script src="js/advanced-filters.js"></script>
    <script src="js/project-comparison.js"></script>
    <script src="js/project-discovery.js"></script>
    <script src="js/comprehensive-rating-system.js"></script>
    <script src="js/rss-feed-manager.js"></script>
    <script src="js/kaspa-sponsorship-system.js"></script>
    <script src="js/kaspa-ecosystem-app.js"></script>
    <script src="js/submit-project.js"></script>
    
    <script>
        // Global app instance
        let app;
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize the app
                app = new KaspaEcosystemApp();
                window.app = app; // Make it global
                
                // Hide loading screen
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    if (loadingScreen) {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 300);
                    }
                }, 500);
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Error loading application', 'error');
            }
        });
        
        // Helper Functions
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const navToggle = document.getElementById('navToggle');
            navMenu.classList.toggle('active');
            navToggle.classList.toggle('active');
        }
        
        function showWalletModal() {
            document.getElementById('wallet-modal').classList.add('show');
        }
        
        function showSubmitModal() {
            const modal = document.getElementById('submit-modal');
            const walletNotice = document.getElementById('wallet-notice');
            const submitBtn = document.getElementById('submit-btn');
            
            if (app && app.walletManager && app.walletManager.isConnected()) {
                walletNotice.style.display = 'none';
                submitBtn.disabled = false;
            } else {
                walletNotice.style.display = 'block';
                submitBtn.disabled = true;
            }
            
            modal.classList.add('show');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function connectWallet(type) {
            if (app && app.connectWallet) {
                app.connectWallet(type);
                closeModal('wallet-modal');
            }
        }
        
        async function submitProject(event) {
            event.preventDefault();
            
            if (!app || !app.walletManager || !app.walletManager.isConnected()) {
                showToast('Please connect your wallet first', 'warning');
                return;
            }
            
            const form = event.target;
            const submitBtn = form.querySelector('#submit-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            
            try {
                const formData = new FormData(form);
                const projectData = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    website: formData.get('website'),
                    logo_url: formData.get('logo_url') || null,
                    twitter: formData.get('twitter') || null,
                    github: formData.get('github') || null,
                    discord: formData.get('discord') || null,
                    telegram: formData.get('telegram') || null,
                    category_slug: formData.get('category'),
                    submitter_wallet: app.walletManager.getAddress()
                };
                
                // Get category ID
                const { data: category } = await supabaseClient
                    .from('categories')
                    .select('id')
                    .eq('slug', projectData.category_slug)
                    .single();
                
                if (!category) throw new Error('Invalid category');
                
                projectData.category_id = category.id;
                delete projectData.category_slug;
                
                // Generate slug
                projectData.slug = projectData.title.toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/^-+|-+$/g, '');
                
                // Submit to Supabase
                const { data, error } = await supabaseClient
                    .from('projects')
                    .insert([projectData])
                    .select()
                    .single();
                
                if (error) throw error;
                
                showToast('Project submitted successfully!', 'success');
                form.reset();
                closeModal('submit-modal');
                
                // Reload projects
                if (app.loadProjects) {
                    app.loadProjects();
                }
                
            } catch (error) {
                console.error('Error submitting project:', error);
                showToast(error.message || 'Failed to submit project', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Project';
            }
        }
        
        function searchProjects(query) {
            if (app && app.searchProjects) {
                app.searchProjects(query);
            }
        }
        
        function sortProjects(sortBy) {
            if (app && app.sortProjects) {
                app.sortProjects(sortBy);
            }
        }
        
        function moveCarousel(direction) {
            if (app && app.moveCarousel) {
                app.moveCarousel(direction);
            }
        }
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} show`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Close modals on outside click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });
        
        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>
</html>
