<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Kaspa Ecosystem</title>
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="stylesheet" href="css/kaspa-ecosystem.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0F172A;
        }
        .login-box {
            background: #1E293B;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .login-title {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #49EACB;
        }
        .password-input {
            width: 100%;
            padding: 12px;
            background: #0F172A;
            border: 1px solid #334155;
            border-radius: 6px;
            color: #CBD5E1;
            margin-bottom: 20px;
            font-size: 16px;
        }
        .password-input:focus {
            outline: none;
            border-color: #49EACB;
        }
        .admin-container {
            display: none;
            padding: 20px;
        }
        .admin-header {
            background: #1E293B;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #1E293B;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #49EACB;
            margin-bottom: 5px;
        }
        .admin-table {
            width: 100%;
            background: #1E293B;
            border-radius: 8px;
            overflow: hidden;
        }
        .admin-table th,
        .admin-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }
        .admin-table th {
            background: #0F172A;
            color: #49EACB;
            font-weight: 600;
        }
        .admin-table tr:hover {
            background: #2D3A4F;
        }
        .action-btn {
            padding: 6px 12px;
            margin: 0 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }
        .action-btn:hover {
            opacity: 0.8;
        }
        .btn-edit {
            background: #3B82F6;
            color: white;
        }
        .btn-delete {
            background: #EF4444;
            color: white;
        }
        .btn-view {
            background: #10B981;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <h1 class="login-title">ðŸ”’ Admin Access</h1>
            <p style="color: #94A3B8; margin-bottom: 30px;">Enter password to access admin panel</p>
            <input 
                type="password" 
                id="password-input" 
                class="password-input" 
                placeholder="Enter password..."
                onkeypress="if(event.key === 'Enter') checkPassword()"
            >
            <button class="btn btn-primary" onclick="checkPassword()" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            <p id="error-message" style="color: #EF4444; margin-top: 20px; display: none;">Incorrect password</p>
        </div>
    </div>

    <!-- Admin Panel (Hidden by default) -->
    <div id="admin-container" class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-tachometer-alt"></i> Kaspa Ecosystem Admin</h1>
            <button class="btn btn-secondary" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-projects">0</div>
                <div>Total Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-users">0</div>
                <div>Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-views">0</div>
                <div>Total Views</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-rating">0.0</div>
                <div>Average Rating</div>
            </div>
        </div>

        <!-- Projects Table -->
        <h2 style="margin-bottom: 20px;"><i class="fas fa-cube"></i> Manage Projects</h2>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Submitter</th>
                    <th>Created</th>
                    <th>Views</th>
                    <th>Rating</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="projects-table-body">
                <!-- Projects will be loaded here -->
            </tbody>
        </table>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
    
    <script>
        // Admin password (in production, this should be server-side)
        const ADMIN_PASSWORD_HASH = 'kaspa2024admin'; // Change this!
        
        // Check password
        function checkPassword() {
            const input = document.getElementById('password-input');
            const password = input.value;
            
            if (password === ADMIN_PASSWORD_HASH) {
                // Store in session
                sessionStorage.setItem('kaspa-admin-auth', 'true');
                
                // Show admin panel
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('admin-container').style.display = 'block';
                
                // Load admin data
                loadAdminData();
            } else {
                document.getElementById('error-message').style.display = 'block';
                input.value = '';
            }
        }
        
        // Check if already authenticated
        if (sessionStorage.getItem('kaspa-admin-auth') === 'true') {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('admin-container').style.display = 'block';
            loadAdminData();
        }
        
        // Logout
        function logout() {
            sessionStorage.removeItem('kaspa-admin-auth');
            location.reload();
        }
        
        // Load admin data
        async function loadAdminData() {
            try {
                // Load projects
                const { data: projects, error } = await supabaseClient
                    .from('projects')
                    .select('*, categories(name)')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                // Calculate statistics
                const totalProjects = projects.length;
                const totalUsers = new Set(projects.map(p => p.submitter_wallet).filter(Boolean)).size;
                const totalViews = projects.reduce((sum, p) => sum + (p.views || 0), 0);
                const avgRating = projects.reduce((sum, p) => sum + (p.average_rating || 0), 0) / totalProjects || 0;
                
                // Update stats
                document.getElementById('total-projects').textContent = totalProjects;
                document.getElementById('total-users').textContent = totalUsers;
                document.getElementById('total-views').textContent = totalViews;
                document.getElementById('avg-rating').textContent = avgRating.toFixed(1);
                
                // Render projects table
                const tbody = document.getElementById('projects-table-body');
                tbody.innerHTML = projects.map(project => `
                    <tr>
                        <td>${project.id}</td>
                        <td>${project.title}</td>
                        <td>${project.categories?.name || 'N/A'}</td>
                        <td>${project.submitter_wallet ? project.submitter_wallet.slice(0, 8) + '...' : 'Anonymous'}</td>
                        <td>${new Date(project.created_at).toLocaleDateString()}</td>
                        <td>${project.views || 0}</td>
                        <td>${project.average_rating?.toFixed(1) || '0.0'}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewProject('${project.website}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-edit" onclick="editProject(${project.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteProject(${project.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading admin data:', error);
                alert('Error loading data: ' + error.message);
            }
        }
        
        // Admin actions
        function viewProject(url) {
            window.open(url, '_blank');
        }
        
        function editProject(id) {
            // In a real implementation, this would open an edit modal
            alert('Edit functionality coming soon for project ID: ' + id);
        }
        
        async function deleteProject(id) {
            if (!confirm('Are you sure you want to delete this project?')) return;
            
            try {
                const { error } = await supabaseClient
                    .from('projects')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                alert('Project deleted successfully');
                loadAdminData(); // Reload data
                
            } catch (error) {
                console.error('Error deleting project:', error);
                alert('Error deleting project: ' + error.message);
            }
        }
    </script>
</body>
</html>
