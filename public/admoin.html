<!-- public/admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kaspa Admin - Moderate Submissions</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
    <div class="max-w-6xl mx-auto p-6">
        <h1 class="text-3xl font-bold mb-6">Moderate Submissions</h1>
        
        <div id="submissions" class="space-y-4">
            <!-- Submissions will load here -->
        </div>
    </div>

    <script>
        // Configuration Supabase avec la clé service_role (UNIQUEMENT pour l'admin)
        const supabase = createClient(
            'https://kaspa-ecosystem.supabase.co',
            'your-service-role-key' // NE JAMAIS exposer publiquement
        );

        async function loadSubmissions() {
            const { data, error } = await supabase
                .from('submissions')
                .select('*')
                .eq('status', 'pending')
                .order('created_at', { ascending: false });

            if (error) {
                console.error(error);
                return;
            }

            const container = document.getElementById('submissions');
            container.innerHTML = data.map(submission => `
                <div class="bg-gray-800 p-6 rounded-lg">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold">${submission.project_data.name}</h3>
                            <p class="text-gray-400">${submission.project_data.category}</p>
                        </div>
                        <span class="text-sm text-gray-500">
                            ${submission.submission_type} - ${new Date(submission.created_at).toLocaleString()}
                        </span>
                    </div>
                    
                    <p class="mb-4">${submission.project_data.description || 'No description'}</p>
                    
                    <div class="text-sm text-gray-400 mb-4">
                        ${submission.project_data.url ? `<p>URL: ${submission.project_data.url}</p>` : ''}
                        ${submission.project_data.github ? `<p>GitHub: ${submission.project_data.github}</p>` : ''}
                        ${submission.project_data.twitter ? `<p>Twitter: ${submission.project_data.twitter}</p>` : ''}
                        ${submission.project_data.tags ? `<p>Tags: ${submission.project_data.tags.join(', ')}</p>` : ''}
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="approveSubmission('${submission.id}')" 
                                class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                            Approve
                        </button>
                        <button onclick="rejectSubmission('${submission.id}')" 
                                class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                            Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function approveSubmission(id) {
            try {
                // Appeler la fonction SQL pour approuver
                const { error } = await supabase.rpc('approve_submission', {
                    submission_id: id
                });

                if (error) throw error;
                alert('Submission approved!');
                loadSubmissions();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function rejectSubmission(id) {
            const { error } = await supabase
                .from('submissions')
                .update({ status: 'rejected', processed_at: new Date() })
                .eq('id', id);

            if (!error) {
                alert('Submission rejected');
                loadSubmissions();
            }
        }

        // Charger au démarrage
        loadSubmissions();
    </script>
</body>
</html>